{"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;IAMA,2CAAe,CAAA,GAAA,WAAG,EAAE;IAClB,KAAK;IACL,WAAW,CAAC,EAAE;QACZ,MAAM,OAAO,CAAA,GAAA,eAAO,EAClB;YACE,UAAU;YACV,UAAU;YACV,YAAY;YACZ,MAAM;QACR,GACA;YACE,MAAM,IAAI,MAAM,IAAI,OAAO;YAC3B,IAAI,KAAK,EAAE,EAAE,EAAE;gBACb,MAAM,MAAM,AAAC,OAAe,UAAU;gBACtC,IAAI,KACF,SAAS;qBACJ;oBACL,QAAQ,GAAG,CAAC;oBACZ,aAAa,OAAO,CAAC,iBAAiB,KAAK,SAAS,CAAC;oBACrD,SAAS;gBACX;YACF,OAAO;gBACL,KAAK,IAAI,GAAG;gBACZ,KAAK,MAAM;YACb;QACF;QAGF,IAAI,CAAC,KAAK,IAAI,EAAE,qBAAO,gBAAC,CAAA,GAAA,cAAM;QAE9B,qBACE,gBAAC;YAAI,WAAU;sBACb,cAAA,iBAAC;gBACC,UAAU,OAAO;oBACf,EAAE,cAAc;oBAChB,KAAK,UAAU,GAAG;oBAClB,KAAK,MAAM;oBACX,MAAM,IAAI,MAAM,IAAI,KAAK,CAAC,KAAK,QAAQ,EAAE,KAAK,QAAQ;oBAEtD,IAAI,EAAE,MAAM,KAAK,UAAU;wBACzB,KAAK,UAAU,GAAG;wBAClB,KAAK,MAAM;wBACX,MAAM,EAAE,MAAM;oBAChB,OAAO;wBACL,MAAM,MAAM,AAAC,OAAe,UAAU;wBACtC,IAAI,KACF,SAAS;6BAET,SAAS;oBAEb;gBACF;gBACA,WAAW,GAAG,6BAA6B,CAAA,GAAA,gBAAQ;;kCAEnD,gBAAC;wBAAI,WAAU;kCAAQ;;kCACvB,iBAAC;wBAAM,WAAU;;0CACf,gBAAC;0CAAK;;0CACN,gBAAC,CAAA,GAAA,YAAI;gCAAE,MAAM;gCAAM,MAAK;;;;kCAE1B,iBAAC;;0CACC,gBAAC;0CAAK;;0CACN,gBAAC,CAAA,GAAA,YAAI;gCAAE,MAAM;gCAAM,MAAK;gCAAW,MAAK;;;;kCAE1C,gBAAC;wBAAO,MAAK;wBAAS,UAAU,KAAK,UAAU;kCAC5C,KAAK,UAAU,GAAG,eAAe;;kCAGpC,gBAAC;wBAAI,WAAU;kCACb,cAAA,gBAAC;4BAAE,MAAK;4BAAY,WAAU;sCAA2B;;;;;;IAOnE;AACF;;;;;;AClFO,MAAM,4CAAY,GAAG,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+C7B,CAAC;;;;;;;;;AC7CM,MAAM,4CAST,CAAC;IACH,MAAM,OAAY;QAAE,GAAG,GAAG;IAAC;IAC3B,MAAM,QAAE,IAAI,QAAE,IAAI,EAAE,GAAG;IACvB,OAAO,KAAK,IAAI;IAChB,OAAO,KAAK,IAAI;IAEhB,IAAI,WAA8C;IAClD,IAAI,KAAK,QAAQ,EAAE;QACjB,WAAW,KAAK,QAAQ;QACxB,OAAO,KAAK,QAAQ;IACtB;IAEA,qBACE,gBAAC;QACC,OAAO,IAAI,CAAC,KAAK,IAAI;QACrB,YAAY;QACZ,SAAS,CAAC;YACR,IAAI,CAAC,KAAK,GAAG,EAAE,aAAa,CAAC,KAAK;YAElC,IAAI,UAAU;gBACZ,MAAM,SAAS,SAAS,EAAE,aAAa,CAAC,KAAK;gBAC7C,IAAI,OAAO,WAAW,aACpB,IAAI,CAAC,KAAK,GAAG;YAEjB;YAEA,KAAK,MAAM;QACb;QACC,GAAG,IAAI;;AAGd","sources":["src/base/page/auth/login.tsx","src/utils/ui/form.style.ts","src/utils/ui/form/input.tsx"],"sourcesContent":["import { page } from \"web-utils\";\nimport { useLocal } from \"web-utils\";\nimport { Loading } from \"../../../utils/ui/loading\";\nimport { formStyle } from \"../../../utils/ui/form.style\";\nimport { Input } from \"../../../utils/ui/form/input\";\n\nexport default page({\n  url: \"/login\",\n  component: ({}) => {\n    const form = useLocal(\n      {\n        username: \"\",\n        password: \"\",\n        submitting: false,\n        init: false,\n      },\n      async () => {\n        const s = await api.session();\n        if (s && s.id) {\n          const rto = (window as any).redirectTo;\n          if (rto) {\n            navigate(rto);\n          } else {\n            console.log(\"navigate to\");\n            localStorage.setItem(\"prasi-session\", JSON.stringify(s));\n            navigate(\"/editor/\");\n          }\n        } else {\n          form.init = true;\n          form.render();\n        }\n      }\n    );\n\n    if (!form.init) return <Loading />;\n\n    return (\n      <div className=\"flex flex-1 flex-col items-center justify-center\">\n        <form\n          onSubmit={async (e) => {\n            e.preventDefault();\n            form.submitting = true;\n            form.render();\n            const s = await api.login(form.username, form.password);\n\n            if (s.status === \"failed\") {\n              form.submitting = false;\n              form.render();\n              alert(s.reason);\n            } else {\n              const rto = (window as any).redirectTo;\n              if (rto) {\n                navigate(rto);\n              } else {\n                navigate(\"/editor\");\n              }\n            }\n          }}\n          className={cx(\"border-[3px] border-black\", formStyle)}\n        >\n          <div className=\"title\">Login</div>\n          <label className=\"mt-3\">\n            <span>Username</span>\n            <Input form={form} name=\"username\" />\n          </label>\n          <label>\n            <span>Password</span>\n            <Input form={form} name=\"password\" type=\"password\" />\n          </label>\n          <button type=\"submit\" disabled={form.submitting}>\n            {form.submitting ? \"Loading...\" : \"Submit\"}\n          </button>\n\n          <div className=\"pt-2\">\n            <a href=\"/register\" className=\"cursor-pointer underline\">\n              Register\n            </a>\n          </div>\n        </form>\n      </div>\n    );\n  },\n});\n","export const formStyle = css`\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n\n  .title {\n    font-size: 18px;\n    display: flex;\n    flex-direction: column;\n  }\n\n  label {\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    margin-bottom: 10px;\n\n    > span {\n      font-size: 14px;\n      margin-bottom: 2px;\n    }\n  }\n  \n  input,\n  select {\n    border: 3px solid black;\n    padding: 3px;\n    width: 300px;\n    font-size: 15px;\n\n    &:disabled {\n      color: #999;\n    }\n  }\n\n  button {\n    color: white;\n    padding: 5px;\n  }\n  button[type=\"submit\"] {\n    background: black;\n\n    &:disabled {\n      background: #999;\n    }\n  }\n`;\n","import { FC } from \"react\";\n\nexport const Input: FC<\n  Omit<\n    React.InputHTMLAttributes<HTMLInputElement>,\n    \"form\" | \"name\" | \"onChange\"\n  > & {\n    form: Record<string, any> & { render: () => void };\n    name: string;\n    onChange?: (text: string) => string | void;\n  }\n> = (arg) => {\n  const prop: any = { ...arg };\n  const { form, name } = arg;\n  delete prop.form;\n  delete prop.name;\n\n  let onChange: ((text: string) => string) | null = null;\n  if (prop.onChange) {\n    onChange = prop.onChange;\n    delete prop.onChange;\n  }\n\n  return (\n    <input\n      value={form[name] || \"\"}\n      spellCheck={false}\n      onInput={(e) => {\n        form[name] = e.currentTarget.value;\n\n        if (onChange) {\n          const result = onChange(e.currentTarget.value);\n          if (typeof result !== \"undefined\") {\n            form[name] = result;\n          }\n        }\n\n        form.render();\n      }}\n      {...prop}\n    />\n  );\n};\n"],"names":[],"version":3,"file":"login.116f51a6.js.map"}