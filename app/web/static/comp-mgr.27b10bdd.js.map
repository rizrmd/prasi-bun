{"mappings":"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","sources":["src/render/editor/panel/manager/comp/comp-mgr.tsx","src/render/editor/panel/manager/comp/comp-preview.tsx"],"sourcesContent":["import { FC, Fragment, ReactElement, useEffect } from \"react\";\nimport { useGlobal, useLocal } from \"web-utils\";\nimport { IItem } from \"../../../../../utils/types/item\";\nimport { Dropdown } from \"../../../../../utils/ui/dropdown\";\nimport { Loading } from \"../../../../../utils/ui/loading\";\nimport { loadComponent } from \"../../../logic/comp\";\nimport { EditorGlobal } from \"../../../logic/global\";\nimport { CItem } from \"./comp-preview\";\n\nconst w = window as unknown as {\n  compManagerSearch: string;\n  compGroup: Record<\n    string,\n    {\n      info: { name: string; id: string };\n      shared: boolean;\n      isOwner: boolean;\n      comps: any[];\n    }\n  >;\n};\nexport const CompManager: FC = () => {\n  const p = useGlobal(EditorGlobal, \"EDITOR\");\n  if (!w.compGroup) w.compGroup = {};\n\n  const local = useLocal({\n    loading: true,\n    group: w.compGroup,\n    init: false,\n    edit_id: \"\",\n    selected_id: \"\",\n    renaming: {\n      id: \"\",\n      text: \"\",\n    },\n    site_use: [] as string[],\n    searchRef: null as any,\n    trash_id: \"\",\n    collapsed: new Set(),\n    sharedPopup: false,\n    checked: new Set<string>(),\n    site_use_loading: false,\n  });\n\n  useEffect(() => {\n    const f = (e: any) => {\n      if (\n        e.key === \"Escape\" &&\n        document.activeElement?.tagName.toLowerCase() === \"input\"\n      ) {\n        w.compManagerSearch = \"\";\n        local.render();\n      }\n      if (\n        local.searchRef &&\n        document.activeElement?.tagName.toLowerCase() !== \"input\"\n      ) {\n        local.searchRef.value = \"\";\n        local.searchRef.focus();\n      }\n    };\n    window.addEventListener(\"keydown\", f);\n    return () => {\n      window.removeEventListener(\"keydown\", f);\n    };\n  }, []);\n\n  const toggleCollapse = (id: string) => {\n    if (!local.collapsed.has(id)) {\n      local.collapsed.add(id);\n    } else {\n      local.collapsed.delete(id);\n    }\n    local.render();\n  };\n\n  const reloadComps = async () => {\n    if (Object.keys(w.compGroup).length > 0) {\n      local.loading = false;\n      local.group = w.compGroup;\n\n      for (const g of Object.values(local.group)) {\n        if (g.info.name === \"__TRASH__\") {\n          local.trash_id = g.info.id;\n          local.collapsed.add(g.info.id);\n        }\n      }\n      local.render();\n      return;\n    }\n\n    if (p.site.id) {\n      local.loading = true;\n      local.site_use = (\n        await db.site_use_comp.findMany({\n          where: {\n            id_site: p.site.id,\n          },\n          select: {\n            use_id_site: true,\n          },\n        })\n      ).map((e) => e.use_id_site);\n      const group = await db.component_group.findMany({\n        where: {\n          component_site: {\n            some: {\n              OR: [\n                {\n                  id_site: p.site.id,\n                },\n                ...local.site_use.map((e) => ({\n                  id_site: e,\n                  component_group: { name: { not: \"__TRASH__\" } },\n                })),\n              ],\n            },\n          },\n        },\n        select: {\n          name: true,\n          id: true,\n          shared: true,\n          component_site: {\n            select: {\n              is_owner: true,\n            },\n            where: {\n              id_site: p.site.id,\n            },\n          },\n        },\n      });\n\n      if (group) {\n        local.group = {};\n        for (const g of group) {\n          if (g.name === \"__TRASH__\") {\n            local.trash_id = g.id;\n            local.collapsed.add(g.id);\n          }\n\n          local.group[g.id] = {\n            info: g,\n            shared: g.shared,\n            isOwner: !!g.component_site[0]?.is_owner,\n            comps: [],\n          };\n        }\n      }\n      const group_ids = Object.keys(local.group);\n\n      if (group_ids.length > 0) {\n        const comps = await db.component.findMany({\n          where: {\n            id_component_group: {\n              in: group_ids,\n            },\n          },\n          select: {\n            id: true,\n            id_component_group: true,\n            name: true,\n          },\n        });\n\n        for (const comp of comps) {\n          const gid = comp.id_component_group;\n          if (gid && local.group[gid]) {\n            local.group[gid].comps.push(comp);\n          }\n        }\n      }\n\n      local.loading = false;\n      w.compGroup = local.group;\n      local.render();\n    }\n  };\n\n  if (!local.init) {\n    local.init = true;\n    reloadComps();\n  }\n\n  const boxClass =\n    \"flex flex-col items-start w-[192px] p-2 text-sm border cursor-pointer hover:bg-blue-100 ml-1 mb-1\";\n\n  let groups = Object.values(local.group).sort((a, b) => {\n    const aname = a.info.name === \"__TRASH__\" ? \"zzzTRASHzzz\" : a.info.name;\n    const bname = b.info.name === \"__TRASH__\" ? \"zzzTRASHzzz\" : b.info.name;\n    return aname.localeCompare(bname);\n  });\n\n  if (w.compManagerSearch) {\n    groups = [...groups].filter((g) => {\n      let count = 0;\n      g.comps.forEach((e) => {\n        const name = e.name.toLowerCase();\n        const id = e.id.toLowerCase();\n\n        if (\n          name.includes(w.compManagerSearch.toLowerCase()) ||\n          id.includes(w.compManagerSearch.toLowerCase())\n        ) {\n          count++;\n          return true;\n        }\n        return false;\n      });\n      return count > 0;\n    });\n  }\n\n  return (\n    <>\n      <div\n        className=\"fixed inset-0 bg-black bg-opacity-10 cursor-pointer\"\n        onClick={() => {\n          p.manager.comp = false;\n          p.manager.compCallback = () => {};\n          p.render();\n        }}\n      ></div>\n      <div\n        className=\"fixed inset-[50px] bg-white shadow-2xl flex\"\n        onClick={(e) => {\n          e.stopPropagation();\n          e.preventDefault();\n        }}\n      >\n        {local.loading ? (\n          <div className=\"flex w-full h-full items-center justify-center\">\n            <Loading note=\"comp-mgr\" backdrop={false} />\n          </div>\n        ) : (\n          <div\n            className={cx(\n              \"relative flex-1 flex\",\n              css`\n                contain: content;\n                overflow: auto;\n\n                .complist {\n                  contain: content;\n                  overflow: auto;\n                }\n              `\n            )}\n          >\n            {/* <Modal\n              open={local.sharedPopup}\n              onOpenChange={(open) => {\n                local.sharedPopup = open;\n                local.render();\n              }}\n            >\n              <CompUseShared\n                onChange={async (group_id) => {\n                  local.sharedPopup = false;\n                  local.loading = true;\n                  local.render();\n\n                  await db.component_site.create({\n                    data: {\n                      id_component_group: group_id,\n                      id_site: p.site?.id || \"\",\n                      is_owner: false,\n                    },\n                  });\n                  w.compGroup = {};\n                  reloadComps();\n                }}\n              />\n            </Modal> */}\n            <div className=\"fixed top-0 right-[20px] bg-white z-10 m-[8px] flex\">\n              {local.checked.size > 0 && (\n                <>\n                  <div\n                    className=\"border text-xs flex items-center px-2 cursor-pointer mr-1\"\n                    onClick={() => {\n                      local.checked.clear();\n                      p.render();\n                    }}\n                  >\n                    Unselect\n                  </div>\n                  <div\n                    className=\"bg-red-500 text-white text-xs flex items-center px-2 cursor-pointer mr-1\"\n                    onClick={async () => {\n                      if (\n                        confirm(\n                          \"Delete component cannot be undone. Are you sure? \"\n                        )\n                      ) {\n                        const totrash: string[] = [];\n                        local.checked.forEach((e) => {\n                          const [id, gid] = e.split(\"|\");\n                          const idx = local.group[gid].comps.findIndex(\n                            (e) => e.id === id\n                          );\n                          const comp = local.group[gid].comps[idx];\n                          if (idx >= 0) {\n                            if (comp.id_component_group !== local.trash_id) {\n                              totrash.push(comp.id);\n                            }\n                          }\n                        });\n                        if (totrash.length > 0) {\n                          if (!local.trash_id) {\n                            const res = await db.component_group.create({\n                              data: {\n                                name: \"__TRASH__\",\n                                component_site: {\n                                  create: {\n                                    id_site: p.site?.id || \"\",\n                                  },\n                                },\n                              },\n                            });\n                            local.trash_id = res.id;\n                          }\n\n                          if (local.trash_id) {\n                            await db.component.updateMany({\n                              where: {\n                                id: { in: totrash },\n                              },\n                              data: {\n                                id_component_group: local.trash_id,\n                              },\n                            });\n\n                            w.compGroup = {};\n\n                            local.checked.clear();\n                            await reloadComps();\n                          }\n                        }\n                      }\n                    }}\n                  >\n                    Delete {local.checked.size} selected\n                  </div>\n                </>\n              )}\n              {/* <div\n                className=\"hover:bg-blue-500 hover:text-white text-xs flex items-center px-2 cursor-pointer border text-blue-500 border-blue-200 mr-1\"\n                onClick={() => {\n                  local.sharedPopup = true;\n                  local.render();\n                }}\n              >\n                Browse Shared\n              </div> */}\n              <input\n                type=\"search\"\n                value={w.compManagerSearch || \"\"}\n                ref={(e) => {\n                  local.searchRef = e;\n                }}\n                onChange={(e) => {\n                  w.compManagerSearch = e.currentTarget.value;\n                  local.render();\n                }}\n                placeholder=\"Search\"\n                className=\"border  px-2 text-sm h-[26px] outline-none w-[150px] focus:border-blue-500 focus:w-[350px] transition-all\"\n              />\n            </div>\n            <div className=\"comp-list flex-1 overflow-auto flex h-full flex-col space-y-2 select-none\">\n              {!local.site_use.includes(\n                \"9e34f31f-4ebd-4630-b61d-597045171ebb\"\n              ) && (\n                <div className=\"flex flex-col self-stretch mx-4 mt-3\">\n                  <div className=\" flex\">\n                    <div\n                      className=\"border border-blue-400 text-sm px-3 cursor-pointer hover:bg-blue-200\"\n                      onClick={async () => {\n                        local.site_use_loading = true;\n                        local.render();\n                        await db.site_use_comp.create({\n                          data: {\n                            id_site: p.site.id,\n                            use_id_site: \"9e34f31f-4ebd-4630-b61d-597045171ebb\",\n                          },\n                        });\n                        w.compGroup = {};\n                        await reloadComps();\n                        local.site_use_loading = false;\n                        local.render();\n                      }}\n                    >\n                      {local.site_use_loading\n                        ? \"Loading...\"\n                        : \"Attach Prasi UI\"}\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {local.site_use.includes(\n                \"9e34f31f-4ebd-4630-b61d-597045171ebb\"\n              ) && (\n                <div className=\"flex flex-col self-stretch mx-4 mt-3\">\n                  <div className=\" flex\">\n                    <div\n                      className=\"border border-slate-400 text-sm px-3 cursor-pointer hover:bg-blue-200\"\n                      onClick={async () => {\n                        if (p.site.id) {\n                          local.site_use_loading = true;\n                          local.render();\n                          await db.site_use_comp.delete({\n                            where: {\n                              id_site_use_id_site: {\n                                id_site: p.site.id,\n                                use_id_site:\n                                  \"9e34f31f-4ebd-4630-b61d-597045171ebb\",\n                              },\n                            },\n                          });\n                          w.compGroup = {};\n                          await reloadComps();\n                          local.site_use_loading = false;\n                          local.render();\n                        }\n                      }}\n                    >\n                      {local.site_use_loading\n                        ? \"Loading...\"\n                        : \"Detach Prasi UI\"}\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {groups.map((g) => {\n                return (\n                  <Fragment key={g.info.id}>\n                    {g.info.name === \"__TRASH__\" && (\n                      <div className=\"flex-1\"></div>\n                    )}\n                    <div className=\"flex flex-col border-b pt-1 pb-1\">\n                      <div\n                        className={cx(\n                          \"p-1 text-base flex items-center space-x-1\",\n                          css`\n                            .act {\n                              display: none;\n                            }\n                            &:hover {\n                              .act {\n                                display: flex;\n                              }\n                            }\n                          `,\n                          g.info.name === \"__TRASH__\" &&\n                            css`\n                              .act {\n                                display: none !important;\n                              }\n                            `\n                        )}\n                      >\n                        {local.renaming.id === g.info.id ? (\n                          <input\n                            value={local.renaming.text}\n                            onChange={(ev) => {\n                              local.renaming.text = ev.currentTarget.value;\n                              local.render();\n                            }}\n                            className=\"border px-1 text-sm\"\n                            autoFocus\n                            spellCheck={false}\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\") e.currentTarget.blur();\n                            }}\n                            onFocus={(e) => {\n                              e.currentTarget.select();\n                            }}\n                            onBlur={(e) => {\n                              g.info.name = e.currentTarget.value;\n                              local.renaming.id = \"\";\n                              local.render();\n\n                              db.component_group.update({\n                                where: {\n                                  id: g.info.id,\n                                },\n                                data: { name: g.info.name },\n                              });\n                            }}\n                          />\n                        ) : (\n                          <>\n                            <div\n                              className=\"cursor-pointer\"\n                              onClick={() => toggleCollapse(g.info.id)}\n                            >\n                              {local.collapsed.has(g.info.id) ? (\n                                <ChevronRight />\n                              ) : (\n                                <ChevronDown />\n                              )}\n                            </div>\n                            <div\n                              className=\"cursor-pointer\"\n                              onClick={() => toggleCollapse(g.info.id)}\n                            >\n                              {g.info.name === \"__TRASH__\" ? (\n                                <div className=\"text-slate-400 text-xs\">\n                                  Deleted Component\n                                </div>\n                              ) : (\n                                g.info.name\n                              )}\n                            </div>\n\n                            {/* {!g.isOwner && (\n                              <div\n                                className=\"cursor-pointer border text-xs px-1 hover:bg-red-100 hover:border-red-500 hover:text-red-600 flex items-center h-[20px]\"\n                                onClick={async () => {\n                                  if (confirm(\"Are you sure ?\")) {\n                                    delete local.group[g.info.id];\n                                    local.render();\n                                    await db.component_site.delete({\n                                      where: {\n                                        id_component_group_id_site: {\n                                          id_component_group: g.info.id,\n                                          id_site: p.site?.id || \"\",\n                                        },\n                                      },\n                                    });\n                                  }\n                                }}\n                              >\n                                Detach\n                              </div>\n                            )} */}\n\n                            {g.shared && g.isOwner && (\n                              <div\n                                className=\"cursor-pointer border ml-1 border-transparent bg-blue-500 text-white text-xs px-1 hover:bg-blue-100 hover:border-blue-500 hover:text-blue-600 flex items-center h-[20px]\"\n                                onClick={async () => {\n                                  g.shared = false;\n\n                                  db.component_group.update({\n                                    where: {\n                                      id: g.info.id,\n                                    },\n                                    data: {\n                                      shared: g.shared,\n                                    },\n                                  });\n                                  local.render();\n                                }}\n                              >\n                                Public\n                              </div>\n                            )}\n                            {!g.shared && g.isOwner && (\n                              <div\n                                className=\"act cursor-pointer ml-1 border text-xs px-1 hover:bg-blue-100 hover:border-blue-500 hover:text-blue-600 flex items-center h-[20px]\"\n                                onClick={async () => {\n                                  g.shared = true;\n\n                                  db.component_group.update({\n                                    where: {\n                                      id: g.info.id,\n                                    },\n                                    data: {\n                                      shared: g.shared,\n                                    },\n                                  });\n                                  local.render();\n                                }}\n                              >\n                                Share\n                              </div>\n                            )}\n                            {g.isOwner && (\n                              <div\n                                className=\"act cursor-pointer border flex items-center hover:bg-blue-100 hover:border-blue-500 hover:text-blue-600 px-1 h-[20px]\"\n                                onClick={() => {\n                                  local.renaming.id = g.info.id;\n                                  local.renaming.text = g.info.name;\n                                  local.render();\n                                }}\n                              >\n                                <Rename />\n                              </div>\n                            )}\n\n                            <div\n                              className=\"act cursor-pointer border text-xs px-1 hover:bg-blue-100 hover:border-blue-500 hover:text-blue-600 flex items-center h-[20px]\"\n                              onClick={async () => {\n                                const name = prompt(`New Group Name:`);\n\n                                if (name) {\n                                  const res = await db.component_group.create({\n                                    data: {\n                                      component_site: {\n                                        create: {\n                                          id_site: p.site?.id || \"\",\n                                        },\n                                      },\n                                      name,\n                                    },\n                                  });\n\n                                  if (res) {\n                                    local.group[res.id] = {\n                                      comps: [],\n                                      shared: false,\n                                      isOwner: true,\n                                      info: res,\n                                    };\n                                    local.render();\n                                  }\n                                }\n                              }}\n                            >\n                              New\n                            </div>\n\n                            {g.comps.length === 0 && (\n                              <div\n                                className=\"act cursor-pointer border text-xs px-1 hover:bg-red-100 hover:border-red-500 hover:text-red-600 flex items-center h-[20px]\"\n                                onClick={async () => {\n                                  if (confirm(\"Are you sure ?\")) {\n                                    delete local.group[g.info.id];\n                                    local.render();\n                                    await db.component_site.delete({\n                                      where: {\n                                        id_component_group_id_site: {\n                                          id_component_group: g.info.id,\n                                          id_site: p.site?.id || \"\",\n                                        },\n                                      },\n                                    });\n                                  }\n                                }}\n                              >\n                                Del\n                              </div>\n                            )}\n                          </>\n                        )}\n                      </div>\n                      <div\n                        className={cx(\n                          \"flex items-start flex-wrap pl-[10px]\",\n                          local.collapsed.has(g.info.id) && \"hidden\"\n                        )}\n                      >\n                        {g.comps.map((e, idx) => {\n                          const name = e.name.toLowerCase();\n                          const id = e.id.toLowerCase();\n\n                          if (\n                            w.compManagerSearch &&\n                            !name.includes(w.compManagerSearch.toLowerCase()) &&\n                            !id.includes(w.compManagerSearch.toLowerCase())\n                          ) {\n                            return null;\n                          }\n                          return (\n                            <div\n                              key={e.id}\n                              className={cx(\n                                boxClass,\n                                \"justify-between transition-all relative\",\n                                local.selected_id === e.id\n                                  ? \"border-blue-500 bg-blue-100\"\n                                  : \"hover:border-blue-500\",\n                                css`\n                                  .edit {\n                                    display: none;\n                                  }\n\n                                  &:hover {\n                                    .edit {\n                                      display: flex;\n                                    }\n                                    .pick {\n                                      opacity: 1;\n                                    }\n                                  }\n                                `\n                              )}\n                              onClick={() => {\n                                local.selected_id = e.id;\n                                local.render();\n                              }}\n                            >\n                              <div\n                                className={cx(\n                                  \"absolute top-0 right-0 flex items-center justify-center w-[20px] h-[20px] border border-r-0 border-t-0\",\n                                  local.checked.has(`${e.id}|${g.info.id}`)\n                                    ? \"bg-blue-500 text-white border-blue-500\"\n                                    : \"bg-white hover:border-blue-500\"\n                                )}\n                                onClick={(ev) => {\n                                  ev.stopPropagation();\n                                  ev.preventDefault();\n                                  if (\n                                    local.checked.has(`${e.id}|${g.info.id}`)\n                                  ) {\n                                    local.checked.delete(\n                                      `${e.id}|${g.info.id}`\n                                    );\n                                  } else {\n                                    local.checked.add(`${e.id}|${g.info.id}`);\n                                  }\n                                  p.render();\n                                }}\n                              >\n                                {local.checked.has(`${e.id}|${g.info.id}`) && (\n                                  <svg\n                                    xmlns=\"http://www.w3.org/2000/svg\"\n                                    width=\"15\"\n                                    height=\"15\"\n                                    fill=\"none\"\n                                    viewBox=\"0 0 15 15\"\n                                  >\n                                    <path\n                                      fill=\"currentColor\"\n                                      fillRule=\"evenodd\"\n                                      d=\"M11.467 3.727c.289.189.37.576.181.865l-4.25 6.5a.625.625 0 01-.944.12l-2.75-2.5a.625.625 0 01.841-.925l2.208 2.007 3.849-5.886a.625.625 0 01.865-.181z\"\n                                      clipRule=\"evenodd\"\n                                    ></path>\n                                  </svg>\n                                )}\n                              </div>\n                              <div className=\"flex flex-col\">\n                                <div>{e.name}</div>\n                                <div className=\"text-slate-400 text-[10px]\">\n                                  {e.id}\n                                </div>\n                              </div>\n                              <div className=\"flex mt-1 justify-between self-stretch\">\n                                <div className=\"flex flex-1 justify-between space-x-1 mr-1\">\n                                  <div\n                                    className=\"pick opacity-10 transition-all bg-blue-500 text-white px-2\"\n                                    onClick={() => {\n                                      p.manager.comp = false;\n                                      if (\n                                        typeof p.manager.compCallback ===\n                                        \"function\"\n                                      ) {\n                                        p.manager.compCallback(e);\n                                        p.manager.compCallback = () => {};\n                                        p.render();\n                                      }\n                                    }}\n                                  >\n                                    {p.manager.compActionLabel}\n                                  </div>\n                                </div>\n                                <div\n                                  onClick={(ev) => {\n                                    ev.preventDefault();\n                                    ev.stopPropagation();\n                                  }}\n                                >\n                                  <Dropdown\n                                    value={g.info.id}\n                                    items={groups\n                                      .filter(\n                                        (e) => e.info.name !== \"__TRASH__\"\n                                      )\n                                      .map((e) => {\n                                        return {\n                                          label: e.info.name,\n                                          value: e.info.id,\n                                        };\n                                      })}\n                                    onChange={(v) => {\n                                      local.group[v].comps.push(e);\n                                      g.comps.splice(idx, 1);\n                                      local.render();\n\n                                      db.component.update({\n                                        where: {\n                                          id: e.id,\n                                        },\n                                        data: {\n                                          id_component_group: v,\n                                        },\n                                        select: { id: true },\n                                      });\n                                    }}\n                                    className=\"max-w-[30px] overflow-hidden border\"\n                                    popover={{\n                                      className: \"text-sm\",\n                                    }}\n                                  />\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </div>\n                  </Fragment>\n                );\n              })}\n            </div>\n          </div>\n        )}\n        {local.selected_id && (\n          <CompPreview\n            comp_id={local.selected_id}\n            onClose={() => {\n              local.selected_id = \"\";\n              local.render();\n            }}\n            opt={\n              <>\n                <div\n                  className={cx(\n                    \"edit bg-red-200 hover:bg-red-500 transition-all px-3 rounded-sm text-sm text-white cursor-pointer\"\n                  )}\n                  onClick={async (ev) => {\n                    if (confirm(\"Are you sure ?\")) {\n                      if (!local.trash_id) {\n                        const res = await db.component_group.create({\n                          data: {\n                            name: \"__TRASH__\",\n                            component_site: {\n                              create: {\n                                id_site: p.site?.id || \"\",\n                              },\n                            },\n                          },\n                        });\n                        local.trash_id = res.id;\n                      }\n\n                      if (local.trash_id) {\n                        await db.component.update({\n                          where: {\n                            id: local.selected_id,\n                          },\n                          data: {\n                            id_component_group: local.trash_id,\n                          },\n                          select: { id: true },\n                        });\n\n                        w.compGroup = {};\n                        await reloadComps();\n                      }\n                    }\n                  }}\n                >\n                  Delete\n                </div>\n              </>\n            }\n          />\n        )}\n      </div>\n    </>\n  );\n};\n\nconst CompPreview: FC<{\n  comp_id: string;\n  onClose: () => void;\n  opt: ReactElement;\n}> = ({ comp_id, onClose, opt }) => {\n  const local = useLocal({ name: \"\", comp: null as null | IItem });\n  const p = useGlobal(EditorGlobal, \"EDITOR\");\n  const comp = p.comps.doc[comp_id];\n\n  p.manager.compPreviewRendered = new Set();\n  if (comp) {\n    local.comp = comp.getMap(\"map\").get(\"content_tree\")?.toJSON() as IItem;\n    if (local.comp) {\n      local.name = local.comp.name;\n    }\n  } else {\n    loadComponent(p, comp_id).then(() => {\n      local.render();\n    });\n  }\n\n  return (\n    <div className=\"border-l w-[35%] transition-all flex flex-col\">\n      <div className=\"border-b p-2 flex justify-between items-center\">\n        <div className=\"flex items-center cursor-pointer\" onClick={onClose}>\n          <ChevronLeft />\n          {local.name || \"Component\"}\n        </div>\n        <div>{opt}</div>\n      </div>\n      <div className={cx(\"flex flex-1 flex-col relative overflow-auto\")}>\n        {!local.comp && <Loading note=\"comp-mgr-2\" backdrop={false} />}\n        <div\n          className={cx(\n            css`\n              contain: content;\n              padding: 20px;\n              overflow: auto;\n            `,\n            \"flex items-center justify-center flex-1 flex-col \"\n          )}\n        >\n          {local.comp && (\n            <CItem item={local.comp} comp_id={local.comp.component?.id || \"\"} />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst Rename = () => (\n  <svg\n    width={12}\n    height={12}\n    viewBox=\"0 0 15 15\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M6.5 1C6.22386 1 6 1.22386 6 1.5C6 1.77614 6.22386 2 6.5 2C7.12671 2 7.45718 2.20028 7.65563 2.47812C7.8781 2.78957 8 3.28837 8 4V11C8 11.7116 7.8781 12.2104 7.65563 12.5219C7.45718 12.7997 7.12671 13 6.5 13C6.22386 13 6 13.2239 6 13.5C6 13.7761 6.22386 14 6.5 14C7.37329 14 8.04282 13.7003 8.46937 13.1031C8.47976 13.0886 8.48997 13.0739 8.5 13.0591C8.51003 13.0739 8.52024 13.0886 8.53063 13.1031C8.95718 13.7003 9.62671 14 10.5 14C10.7761 14 11 13.7761 11 13.5C11 13.2239 10.7761 13 10.5 13C9.87329 13 9.54282 12.7997 9.34437 12.5219C9.1219 12.2104 9 11.7116 9 11V4C9 3.28837 9.1219 2.78957 9.34437 2.47812C9.54282 2.20028 9.87329 2 10.5 2C10.7761 2 11 1.77614 11 1.5C11 1.22386 10.7761 1 10.5 1C9.62671 1 8.95718 1.29972 8.53063 1.89688C8.52024 1.91143 8.51003 1.92611 8.5 1.9409C8.48997 1.92611 8.47976 1.91143 8.46937 1.89688C8.04282 1.29972 7.37329 1 6.5 1ZM14 5H11V4H14C14.5523 4 15 4.44772 15 5V10C15 10.5523 14.5523 11 14 11H11V10H14V5ZM6 4V5H1L1 10H6V11H1C0.447715 11 0 10.5523 0 10V5C0 4.44772 0.447715 4 1 4H6Z\"\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n    ></path>\n  </svg>\n);\nconst chevronSize = 12;\n\nexport const ChevronRight = () => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width={chevronSize}\n    height={chevronSize}\n    fill=\"none\"\n    viewBox=\"0 0 15 15\"\n  >\n    <path\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n      d=\"M6.158 3.135a.5.5 0 01.707.023l3.75 4a.5.5 0 010 .684l-3.75 4a.5.5 0 11-.73-.684L9.566 7.5l-3.43-3.658a.5.5 0 01.023-.707z\"\n      clipRule=\"evenodd\"\n    ></path>\n  </svg>\n);\n\nexport const ChevronDown = () => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width={chevronSize}\n    height={chevronSize}\n    fill=\"none\"\n    viewBox=\"0 0 15 15\"\n  >\n    <path\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n      d=\"M3.135 6.158a.5.5 0 01.707-.023L7.5 9.565l3.658-3.43a.5.5 0 01.684.73l-4 3.75a.5.5 0 01-.684 0l-4-3.75a.5.5 0 01-.023-.707z\"\n      clipRule=\"evenodd\"\n    ></path>\n  </svg>\n);\n\nexport const ChevronLeft = () => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"22\"\n    height=\"22\"\n    viewBox=\"0 0 24 24\"\n  >\n    <path\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n      d=\"M14 18l-6-6 6-6 1.4 1.4-4.6 4.6 4.6 4.6L14 18z\"\n    ></path>\n  </svg>\n);\n","import { useGlobal, useLocal } from \"web-utils\";\nimport { produceCSS } from \"../../../../../utils/css/gen\";\nimport { IItem } from \"../../../../../utils/types/item\";\nimport { EditorGlobal } from \"../../../logic/global\";\nimport { Loading } from \"../../../../../utils/ui/loading\";\nimport { loadComponent } from \"../../../logic/comp\";\n\nexport const CItem = ({ item, comp_id }: { item: IItem; comp_id: string }) => {\n  const p = useGlobal(EditorGlobal, \"EDITOR\");\n  const className = produceCSS(item, {\n    mode: p.mode,\n  });\n  const local = useLocal({});\n\n  if (p.manager.compPreviewRendered.has(item.id)) {\n    return null;\n  }\n  p.manager.compPreviewRendered.add(item.id);\n\n  if (item.component && item.component.id && item.component.id !== comp_id) {\n    if (\n      !p.comps.doc[item.component.id] ||\n      !!p.comps.pending[item.component.id]\n    ) {\n      loadComponent(p, item.component.id).then(() => {\n        local.render();\n      });\n      return <Loading backdrop={false} />;\n    }\n\n    if (p.comps.doc[item.component.id]) {\n      const citem = p.comps.doc[item.component.id]\n        .getMap(\"map\")\n        .get(\"content_tree\")\n        ?.toJSON() as IItem;\n      if (citem) {\n        return <CItem item={citem} comp_id={comp_id} />;\n      }\n    }\n  }\n\n  return (\n    <div className={className}>\n      {item.childs.map((e) => {\n        if (e.type === \"item\")\n          return <CItem key={e.id} item={e} comp_id={comp_id} />;\n\n        const className = produceCSS(e, {\n          mode: p.mode,\n        });\n\n        return (\n          <div\n            key={e.id}\n            className={className}\n            dangerouslySetInnerHTML={{ __html: e.html }}\n          ></div>\n        );\n      })}\n    </div>\n  );\n};\n"],"names":[],"version":3,"file":"comp-mgr.27b10bdd.js.map"}