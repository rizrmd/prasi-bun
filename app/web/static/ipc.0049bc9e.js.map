{"mappings":"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","sources":["src/render/editor/panel/script/esbuild/ipc.ts","src/render/editor/panel/script/esbuild/output.ts","../../node_modules/@parcel/runtime-js/lib/runtime-38af99e6ab366962.js"],"sourcesContent":["// This file is responsible for spawning and terminating child worker threads.\n// The worker thread is recreated every time the current API version changes.\n\nimport { OutputFile, showLoadingFailure, showLoadingMessage } from \"./output\";\nimport { setReloadWorkerCallback } from \"./versions\";\n\nexport type IPCRequest = TransformRequest | BuildRequest;\nexport type IPCResponse = TransformResponse & BuildResponse;\n\nexport interface TransformRequest {\n  command_: \"transform\";\n  input_: string;\n  options_: Record<string, any>;\n}\n\nexport interface TransformResponse {\n  code_?: string;\n  map_?: string;\n  mangleCache_?: Record<string, string | boolean>;\n  legalComments_?: string;\n  stderr_?: string;\n}\n\nexport interface BuildRequest {\n  command_: \"build\";\n  input_: Record<string, string>;\n  options_: Record<string, any>;\n}\n\nexport interface BuildResponse {\n  outputFiles_?: OutputFile[];\n  metafile_?: string;\n  mangleCache_?: Record<string, string | boolean>;\n  stderr_?: string;\n}\n\ninterface Task {\n  message_: any;\n  resolve_: (value: any) => void;\n  abort_: () => void;\n}\n\nconst workerText = fetch(new URL(\"./worker\", import.meta.url)).then((r) =>\n  r.text()\n);\nlet activeTask: Task | null = null;\nlet pendingTask: Task | null = null;\n\nlet workerPromise = new Promise<Worker>((resolve, reject) => {\n  setReloadWorkerCallback((version) => {\n    const reloadPromise = reloadWorker(version);\n    reloadPromise.then(resolve, reject);\n    setReloadWorkerCallback((version) => {\n      workerPromise.then((worker) => worker.terminate());\n      workerPromise = reloadWorker(version);\n      return workerPromise;\n    });\n    return reloadPromise;\n  });\n});\n\nasync function packageFetch(subpath: string): Promise<Response> {\n  const controller = new AbortController();\n  const timeout = setTimeout(() => controller.abort(\"Timeout\"), 5000);\n\n  // Try to fetch from one CDN, but fall back to another CDN if that fails\n  try {\n    const response = await fetch(`https://cdn.jsdelivr.net/npm/${subpath}`, {\n      signal: controller.signal,\n    });\n    if (response.ok) {\n      clearTimeout(timeout);\n      return response;\n    }\n  } catch (err) {\n    console.error(err);\n  }\n  return fetch(`https://unpkg.com/${subpath}`);\n}\n\nasync function reloadWorker(version: string): Promise<Worker> {\n  let loadingFailure: string | undefined;\n  showLoadingMessage(version);\n\n  try {\n    if (activeTask) activeTask.abort_();\n    if (pendingTask) pendingTask.abort_();\n    activeTask = null;\n    pendingTask = null;\n\n    // \"browser.min.js\" was added in version 0.8.33\n    const [major, minor, patch] = version.split(\".\").map((x) => +x);\n    const min =\n      major === 0 && (minor < 8 || (minor === 8 && patch < 33)) ? \"\" : \".min\";\n\n    const polywasm = /^\\?polywasm=([01])$/.exec(location.search)?.[1];\n    const [workerJS, esbuildJS, esbuildWASM] = await Promise.all([\n      workerText,\n      packageFetch(`esbuild-wasm@${version}/lib/browser${min}.js`).then((r) =>\n        r.text()\n      ),\n      packageFetch(`esbuild-wasm@${version}/esbuild.wasm`).then((r) =>\n        r.arrayBuffer()\n      ),\n    ]);\n    const parts = [esbuildJS, `\\nvar polywasm=${polywasm};`, workerJS];\n    const url = URL.createObjectURL(\n      new Blob(parts, { type: \"application/javascript\" })\n    );\n\n    return await new Promise<Worker>((resolve, reject) => {\n      const worker = new Worker(url);\n      worker.onmessage = (e) => {\n        if (e.data.status_ === \"slow\") {\n          const slowEl = document.getElementById(\"slowWarning\")!;\n          slowEl.innerHTML =\n            \"<span>⚠️ Processing is slow because </span><span>WebAssembly is disabled ⚠️</span>\";\n          slowEl.style.display = \"flex\";\n          return;\n        }\n        worker.onmessage = null;\n        if (e.data.status_ === \"success\") {\n          resolve(worker);\n        } else {\n          reject(new Error(\"Failed to create worker\"));\n          loadingFailure = e.data.error_;\n        }\n        URL.revokeObjectURL(url);\n      };\n      worker.postMessage([version, esbuildWASM], [esbuildWASM]);\n    });\n  } catch (err) {\n    showLoadingFailure(loadingFailure || err + \"\");\n    throw err;\n  }\n}\n\nexport function sendIPC(message: IPCRequest): Promise<IPCResponse> {\n  function activateTask(worker: Worker, task: Task): void {\n    if (activeTask) {\n      if (pendingTask) pendingTask.abort_();\n      pendingTask = task;\n    } else {\n      activeTask = task;\n      worker.onmessage = (e) => {\n        worker.onmessage = null;\n        task.resolve_(e.data);\n        activeTask = null;\n        if (pendingTask) {\n          activateTask(worker, pendingTask);\n          pendingTask = null;\n        }\n      };\n      worker.postMessage(task.message_);\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    workerPromise.then(\n      (worker) =>\n        activateTask(worker, {\n          message_: message,\n          resolve_: resolve,\n          abort_: () => reject(new Error(\"Task aborted\")),\n        }),\n      reject\n    );\n  });\n}\n","// This file implements the UI for the output panel (the right half of the UI)\n\nimport { BuildResponse, TransformResponse } from \"./ipc\";\nimport { generateSourceMapLink, toggleInlineSourceMapLink } from \"./sourcemap\";\n\nexport interface OutputFile {\n  path: string;\n  text: string;\n}\n\nexport function prettyPrintErrorAsStderr(err: RichError): string {\n  let text = `\\x1B[31m✘ \\x1B[41;31m[\\x1B[41;97mERROR\\x1B[41;31m]\\x1B[0m \\x1B[1m${\n    (err && err.message) || err\n  }\\x1B[0m`;\n  const location = err && err.location_;\n  const notes = err && err.notes_;\n  if (location) text += prettyPrintLocationAsStderr(location);\n  if (notes) {\n    for (const note of notes) {\n      text += `\\n  ${note.text_}`;\n      if (note.location_) text += prettyPrintLocationAsStderr(note.location_);\n    }\n  }\n  return text;\n}\n\nexport type RichError = Error & {\n  location_?: Location;\n  notes_: { text_: string; location_?: Location }[];\n};\n\nexport interface Location {\n  file_: string;\n  line_: number; // 1-based\n  column_: number; // 0-based, in UTF-16 code units\n  length_: number; // in UTF-16 code units\n  lineText_: string;\n  suggestion_?: string;\n}\n\nfunction prettyPrintLocationAsStderr({\n  file_,\n  line_,\n  column_,\n  length_,\n  lineText_,\n  suggestion_,\n}: Location): string {\n  let last = length_ < 2 ? \"^\" : \"~\".repeat(length_);\n  let result = `\\n\\n    ${file_}:${line_}:${column_}:\\n`;\n  result +=\n    `\\x1B[37m${line_.toString().padStart(7)} │ ${lineText_.slice(0, column_)}` +\n    `\\x1B[32m${lineText_.slice(column_, column_ + length_)}` +\n    `\\x1B[37m${lineText_.slice(column_ + length_)}\\n`;\n  if (suggestion_) {\n    result += `        │ ${\" \".repeat(column_)}\\x1B[32m${last}\\x1B[37m\\n`;\n    last = suggestion_;\n  }\n  result += `        ╵ ${\" \".repeat(column_)}\\x1B[32m${last}\\x1B[0m\\n`;\n  return result;\n}\n\nexport function updateTransformOutput({\n  code_,\n  map_,\n  mangleCache_,\n  legalComments_,\n  stderr_,\n}: TransformResponse): void {}\n\nexport function updateBuildOutput(\n  { outputFiles_, metafile_, mangleCache_, stderr_ }: BuildResponse,\n  entryPointCount: number\n): void {}\n\nexport function showLoadingMessage(version: string | null): void {}\n\nexport function showLoadingFailure(error: string): void {}\n\nexport function terminalEscapeCodesToHTML(text: string): string {\n  return (\n    \"<span>\" +\n    text\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\")\n      .replace(/\\033\\[([^m]*)m/g, (_, escape) => {\n        switch (escape) {\n          case \"1\":\n            return '</span><span class=\"color-bold\">';\n          case \"31\":\n            return '</span><span class=\"color-red\">';\n          case \"32\":\n            return '</span><span class=\"color-green\">';\n          case \"33\":\n            return '</span><span class=\"color-yellow\">';\n          case \"35\":\n            return '</span><span class=\"color-magenta\">'; // This is generated by warnings in version 0.14.0 and earlier\n          case \"37\":\n            return '</span><span class=\"color-dim\">';\n          case \"41;31\":\n            return '</span><span class=\"bg-red color-red\">';\n          case \"41;97\":\n            return '</span><span class=\"bg-red color-white\">';\n          case \"43;33\":\n            return '</span><span class=\"bg-yellow color-yellow\">';\n          case \"43;30\":\n            return '</span><span class=\"bg-yellow color-black\">';\n          case \"0\":\n            return \"</span><span>\";\n        }\n        throw new Error(`Unknown escape sequence: ${escape}`);\n      }) +\n    \"</span>\"\n  );\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('cb3VD') + \"worker.0b25d7de.js\";"],"names":[],"version":3,"file":"ipc.0049bc9e.js.map"}