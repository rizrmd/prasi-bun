!function(e,t,a,i,o){var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s="function"==typeof r[i]&&r[i],l=s.cache||{},n="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(t,a){if(!l[t]){if(!e[t]){var o="function"==typeof r[i]&&r[i];if(!a&&o)return o(t,!0);if(s)return s(t,!0);if(n&&"string"==typeof t)return n(t);var c=Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}u.resolve=function(a){var i=e[t][1][a];return null!=i?i:a},u.cache={};var p=l[t]=new d.Module(t);e[t][0].call(p.exports,u,p,p.exports,this)}return l[t].exports;function u(e){var t=u.resolve(e);return!1===t?{}:d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=l,d.parent=s,d.register=function(t,a){e[t]=[function(e,t){t.exports=a},{}]},Object.defineProperty(d,"root",{get:function(){return r[i]}}),r[i]=d;for(var c=0;c<t.length;c++)d(t[c])}({bPAlk:[function(e,t,a){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(a);var i=e("react/jsx-runtime"),o=e("uuid"),r=e("web-utils"),s=e("../../nova/ed/logic/ed-global"),l=e("../../nova/ed/logic/ed-sync"),n=e("../../utils/ui/loading"),d=e("../../nova/vi/preview");a.default=(0,r.page)({url:"/vi/:domain/**",component:({})=>{let t=(0,r.useGlobal)(s.EDGlobal,"EDITOR");params.site_id=params.domain;let a=`/${"_"===params._?"":params._}`;if((0,o.validate)(params._)){let e=params._.split("/");params.page_id=e.shift(),a=`/${e.join("/")}`}return(window.pathname=a,window.Y)?(0,l.edInitSync)(t)||t.sync?(0,i.jsx)(d.ViPreview,{pathname:a}):(0,i.jsx)(n.Loading,{note:"connecting-ws"}):((async()=>{window.Y=await e("c10c8889489e84f7"),window.syncronize=(await e("811adecf40594e30")).syncronize,t.render()})(),(0,i.jsx)(n.Loading,{note:"init"}))}})},{"react/jsx-runtime":"16Crh",uuid:"6FIHJ","web-utils":"8vvzC","../../nova/ed/logic/ed-global":"6QDfO","../../nova/ed/logic/ed-sync":"5NVm2","../../utils/ui/loading":"loFlS","../../nova/vi/preview":"i5ggv",c10c8889489e84f7:"4utJ4","811adecf40594e30":"kPzuv","@parcel/transformer-js/src/esmodule-helpers.js":"4uUBn"}],i5ggv:[function(e,t,a){var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(a),i.export(a,"ViPreview",()=>x);var o=e("react/jsx-runtime"),r=e("idb-keyval"),s=e("ua-parser-js"),l=i.interopDefault(s),n=e("wasm-gzip"),d=i.interopDefault(n),c=e("web-utils"),p=e("../../utils/types/general"),u=e("../../utils/ui/deadend"),f=e("../../utils/ui/loading"),m=e("../ed/logic/ed-global"),g=e("../ed/logic/ed-route"),h=e("../ed/logic/ed-site"),v=e("../ed/logic/tree/build"),y=e("./render/script/extract-nav"),w=e("./vi");let b=new TextDecoder,x=e=>{let t=(0,c.useGlobal)(m.EDGlobal,"EDITOR");if(t.site.id){if(!t.mode&&t.site.responsive){if("mobile-only"!==t.site.responsive&&"desktop-only"!==t.site.responsive){let e=(0,l.default)();t.mode="mobile"===e.device.type?"mobile":"desktop"}else"mobile-only"===t.site.responsive?t.mode="mobile":"desktop-only"===t.site.responsive&&(t.mode="desktop")}localStorage.getItem("prasi-editor-mode")&&(t.mode=localStorage.getItem("prasi-editor-mode"))}if(p.w.navigateOverride=e=>{if(e&&e.startsWith("/")&&(p.w.basepath.length>1&&(e=`${p.w.basepath}${e}`),(4===location.hostname.split(".").length||"prasi.app"===location.hostname||"prasi.avolut.com"===location.hostname||location.hostname.includes("ngrok")||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"10.0.2.2"===location.hostname)&&location.pathname.startsWith("/vi")&&!e.startsWith("/vi"))){let t=location.pathname.split("/");e=`/vi/${t[2]}${e}`}return e},j(t),"ready"!==t.status&&"reload"!==t.status)return"page-not-found"===t.status?(0,o.jsx)(u.DeadEnd,{back:()=>{history.back()},children:"Page Not Found"}):(0,o.jsx)(f.Loading,{note:t.status+"-page"});let a=t.mode;return(0,o.jsx)("div",{className:cx("relative flex flex-1 items-center justify-center"),children:(0,o.jsx)("div",{className:cx("absolute flex flex-col items-stretch flex-1 bg-white main-content-preview","mobile"===a?css`
                @media (min-width: 768px) {
                  border-left: 1px solid #ccc;
                  border-right: 1px solid #ccc;
                  width: 375px;
                  top: 0px;
                  overflow-x: hidden;
                  overflow-y: auto;
                  bottom: 0px;
                }
                @media (max-width: 767px) {
                  left: 0px;
                  right: 0px;
                  top: 0px;
                  bottom: 0px;
                  overflow-y: auto;
                }
              `:"inset-0 overflow-auto",css`
            contain: content;
          `),children:(0,o.jsx)(w.Vi,{meta:t.page.meta,mode:t.mode,api_url:t.site.config.api_url,site_id:t.site.id,page_id:t.page.cur.id,entry:t.page.entry,api:t.script.api,db:t.script.db,layout:t.site.layout.id&&t.site.layout.meta?{id:t.site.layout.id,meta:t.site.layout.meta,entry:t.site.layout.entry}:void 0,render_stat:"disabled",script:{init_local_effect:t.script.init_local_effect},on_preload:async({urls:e})=>{let a=[];if(t.preview.url_cache)for(let i of e)t.preview.url_cache.has(i)||(a.push(i),t.preview.url_cache.add(i));if(a.length>0){let e=await t.sync?.page.cache(t.site.id,a,[...Object.keys(t.preview.page_cache)]);if(e)for(let[a,i]of Object.entries(JSON.parse(b.decode((0,n.decompress)(e.gzip))||"{}")))t.preview.page_cache[a]=i,await (0,v.treeCacheBuild)(t,a)}}})})})},_={first_render:!0},j=async e=>{if(e.sync&&("ready"===e.status||"init"===e.status)){if("init"===e.status&&await (0,d.default)(),!e.site.domain&&!e.site.name){e.status="load-site";let t=await e.sync.site.load(e.site.id);if(!t){e.status="site-not-found",e.render();return}await (0,h.loadSite)(e,t,"from-route"),e.site.layout.id&&!e.page.list[e.site.layout.id]&&(await (0,g.loadPageMetaCache)(e,e.site.layout.id)?(0,g.reloadLayout)(e,e.site.layout.id,"load-route"):await (0,g.reloadLayout)(e,e.site.layout.id,"load-route"))}if(e.page.cur.id!==params.page_id||!e.page.cur.snapshot||!e.page.list[e.page.cur.id]){let t=e.page.list[params.page_id];if(t&&e.page.doc&&t.on_update){e.page.doc.off("update",t.on_update);let a=e.page.list[params.page_id];e.page.cur=a.page,e.page.doc=a.doc}if(e.script.init_local_effect={},!p.w.isEditor){if(_.first_render)_.first_render=!1;else{if(e.page.doc){let t=e.page.list[params.page_id];t||(e.page.list[params.page_id]={},t=e.page.list[params.page_id]),t&&t.on_update&&(t.doc.off("update",t.on_update),t.doc.destroy(),delete e.page.list[params.page_id])}let t=e.preview.meta_cache[params.page_id],a=!1;if(!t){let i=await (0,r.get)(`page-${params.page_id}`,y.nav.store);i&&(t=i,e.preview.meta_cache[params.page_id]=i,a=!0)}if(t&&t.entry.length>0){e.page.meta=t.meta,e.page.entry=t.entry,e.page.cur.id!==params.page_id&&(e.page.cur={id:params.page_id}),e.status="ready",a&&e.render();return}}}await (0,g.reloadPage)(e,params.page_id,"load-route")}}}},{"react/jsx-runtime":"16Crh","idb-keyval":"8Atof","ua-parser-js":"3HiP9","wasm-gzip":"lSV23","web-utils":"8vvzC","../../utils/types/general":"fBAQm","../../utils/ui/deadend":"4Kzhl","../../utils/ui/loading":"loFlS","../ed/logic/ed-global":"6QDfO","../ed/logic/ed-route":"5aNau","../ed/logic/ed-site":"fbNqA","../ed/logic/tree/build":"dNllk","./render/script/extract-nav":"hXbWs","./vi":"lSNIl","@parcel/transformer-js/src/esmodule-helpers.js":"4uUBn"}],"4Kzhl":[function(e,t,a){var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(a),i.export(a,"DeadEnd",()=>r);var o=e("react/jsx-runtime");let r=({children:e,back:t})=>(0,o.jsxs)("div",{className:"flex items-center justify-center w-full h-full fixed inset-0 flex-col",children:[(0,o.jsx)("div",{children:e}),(0,o.jsxs)("div",{className:"border mt-2 rounded-md p-2 cursor-pointer",onClick:t||(()=>{history.back()}),children:[" ","Go Back"]})]})},{"react/jsx-runtime":"16Crh","@parcel/transformer-js/src/esmodule-helpers.js":"4uUBn"}],"4utJ4":[function(e,t,a){t.exports=Promise.resolve(t.bundle.root("hZY7I"))},{}],kPzuv:[function(e,t,a){t.exports=e("4c40ba37ea013d84")(e("b62a8e7a2f3947").resolve("01NBn")).then(()=>t.bundle.root("fLhIn"))},{"4c40ba37ea013d84":"jum0m",b62a8e7a2f3947:"4RrD7"}]},[],0,"parcelRequire2d1f");
//# sourceMappingURL=vi.c4879a3f.js.map
